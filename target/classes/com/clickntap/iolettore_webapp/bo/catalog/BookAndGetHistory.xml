<bean cache="catalog_bookandgethistory">
    <validation>
      <group name="create,update"><![CDATA[
        ${this.assertNotEmpty("bookGetId")}
        ${this.assertNotEmpty("state")}
      ]]></group>
      <group name="create"><![CDATA[
      ]]></group>
    </validation>
    <read name="id"><![CDATA[
        select
          id as "id",
          book_get_id as "bookGetId",
          state as "state",
          creation_date as "creationDate",
          last_modified as "lastModified"
        from
          io_bookandgethistory
        where
          id = ${this.id}
    ]]></read>

    
    <update><![CDATA[
        update io_bookandgethistory
        set
          book_get_id = ${this.bookGetId},
          state = ${this.state},
          last_modified = ${this.now()}
        where
          id = ${this.id}
    ]]></update>
    <execute name="touch"><![CDATA[
        update io_bookandgethistory
        set
          last_modified = ${this.now()}
        where
          id = ${this.id}
    ]]></execute>
    <create><![CDATA[
        insert into io_bookandgethistory (
          [#if this.bean.id??]id,[/#if]
          book_get_id,
          state,
          creation_date,
          last_modified
        ) values (
          [#if this.bean.id??]${this.id},[/#if]
          ${this.bookGetId},
          coalesce(${this.state},1),
          [#if this.bean.creationDate??]${this.creationDate}[#else]${this.now()}[/#if],
          [#if this.bean.lastModified??]${this.lastModified}[#else]${this.now()}[/#if]
        )
    ]]></create>
    <delete><![CDATA[
      delete from
        io_bookandgethistory
      where
        id = ${this.id}
    ]]></delete>
    <curr-val><![CDATA[
        select LAST_INSERT_ID() as id
    ]]></curr-val>
</bean>
